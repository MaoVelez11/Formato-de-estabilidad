<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Seguimiento de Productos en Estabilidad</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <header>
    <img src="/images/logo.png" alt="Samara Cosmetics Logo">
    <h1>MÃ³dulo de Seguimiento de Estabilidad</h1>
    <a href="formato.html" class="btn">Ir a Formato Completo âž”</a>
  </header>

  <h2>SEGUIMIENTO PRODUCTOS EN PRUEBAS DE ESTABILIDAD ACELERADA Y NATURAL</h2>
  
  <table id="tablaEstabilidad">
    <thead>
      <tr>
        <th>CONSECUTIVO</th>
        <th>REFERENCIA</th>
        <th>PRODUCTO</th>
        <th>REGISTRO SANITARIO</th>
        <th>LOTE</th>
        <th>DESCRIPCIÃ“N</th>
        <th>PRUEBAS</th>
        <th>OBSERVACIONES</th>
        <th>TOTAL UNIDADES</th>
        <th>T0 (LiberaciÃ³n)</th>
        <th>FECHA INGRESO</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td><input type="text"></td>
        <td><input type="text" value="SUNSCREEN - PROTECTOR SOLAR SPF 50"></td>
        <td><input type="text" value="NSOC06553-21CO"></td>
        <td><input type="text" value="SM0690225"></td>
        <td><input type="text" value="PROTECTOR SOLAR SPF 50 CON COLOR - MAWIE (80 ML)"></td>
        <td><input type="text" value="Apariencia, color, pH, Densidad, Viscosidad, etc."></td>
        <td><textarea></textarea></td>
        <td><input type="number"></td>
        <td><input type="date"></td>
        <td><input type="date"></td>
      </tr>
    </tbody>
  </table>
  
  <button class="btn" onclick="agregarFila()">âž• Agregar Fila</button>
  <button class="btn" style="background-color: #65b45a;" onclick="guardarDatosSeguimiento()">ðŸ’¾ Guardar Datos</button>

  <script>
    let consecutivo = 1;
    function agregarFila() {
      consecutivo++;
      const tabla = document.getElementById("tablaEstabilidad").getElementsByTagName("tbody")[0];
      const nuevaFila = tabla.insertRow();
      nuevaFila.innerHTML = `
        <td>${consecutivo}</td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text"></td>
        <td><input type="text" value="Apariencia, color, pH, Densidad, Viscosidad, etc."></td>
        <td><textarea></textarea></td>
        <td><input type="number"></td>
        <td><input type="date"></td>
        <td><input type="date"></td>
      `;
    }

    function guardarDatosSeguimiento() {
      const fila = document.querySelector("#tablaEstabilidad tbody tr"); // Simplificado para guardar la primera fila por ahora
      const data = {
        consecutivo: fila.cells[0].innerText,
        referencia: fila.cells[1].querySelector('input').value,
        producto: fila.cells[2].querySelector('input').value,
        registro_sanitario: fila.cells[3].querySelector('input').value,
        lote: fila.cells[4].querySelector('input').value,
        descripcion: fila.cells[5].querySelector('input').value,
        pruebas: fila.cells[6].querySelector('input').value,
        observaciones: fila.cells[7].querySelector('textarea').value,
        unidades: fila.cells[8].querySelector('input').value,
        fecha_liberacion: fila.cells[9].querySelector('input').value,
        fecha_inicio_camaras: fila.cells[10].querySelector('input').value,
      };

      if (!data.lote) {
        alert("El campo 'LOTE' es obligatorio para guardar.");
        return;
      }
      
      fetch('/api/estudio', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(response => {
        console.log('Success:', response);
        alert(`Estudio para el lote ${data.lote} guardado exitosamente.`);
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Hubo un error al guardar los datos.');
      });
    }
  </script>

</body>
</html>