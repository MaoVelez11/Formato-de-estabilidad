<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formato Estudio de Estabilidad</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <header>
    <img src="/images/logo.png" alt="Samara Cosmetics Logo">
    <h1>Formato Completo de Estabilidad</h1>
    <a href="seguimiento.html" class="btn">·êä Volver a Seguimiento</a>
  </header>

  <form id="formato-completo">
    <h2>INFORMACI√ìN GENERAL</h2>
    <table>
      <tr><td class="label">Notificaci√≥n sanitaria</td><td><input type="text" name="nso"></td></tr>
      <tr><td class="label">Producto</td><td><input type="text" name="producto"></td></tr>
      <tr><td class="label">N√∫mero de lote</td><td><input type="text" name="lote" id="lote-principal" required></td></tr>
      <tr><td class="label">Fabricante</td><td><input type="text" name="fabricante"></td></tr>
      <tr><td class="label">Titular del registro</td><td><input type="text" name="titular"></td></tr>
      <tr><td class="label">Lugar de realizaci√≥n del estudio</td><td><input type="text" name="lugar"></td></tr>
      <tr><td class="label">Fecha inicio del estudio</td><td><input type="date" name="fecha_inicio"></td></tr>
      <tr><td class="label">Fecha de finalizaci√≥n del estudio</td><td><input type="date" name="fecha_fin"></td></tr>
    </table>

    <h2>Estabilidad Acelerada</h2>
    <table data-tipo-estabilidad="Acelerada">
        <thead>
            <tr>
              <th>An√°lisis</th>
              <th>Par√°metro evaluado</th>
              <th>M√©todo utilizado</th>
              <th>Especific.</th>
              <th>T0</th><th>T1</th><th>T2</th><th>T3</th>
            </tr>
        </thead>
        <tbody>
            <tr>
              <td rowspan="4">Organol√©ptico</td>
              <td data-parametro="Apariencia">Apariencia</td><td>Sensiorial</td><td><input type="text"></td>
              <td><select data-tiempo="T0"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T1"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T2"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T3"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
            </tr>
            <tr>
              <td data-parametro="Color">Color</td><td>Sensiorial</td><td><input type="text"></td>
              <td><select data-tiempo="T0"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T1"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T2"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T3"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
            </tr>
            <tr>
              <td data-parametro="Aplicacion">Aplicacion</td><td>Sensiorial</td><td><input type="text"></td>
              <td><select data-tiempo="T0"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T1"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T2"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T3"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
            </tr>
            <tr>
              <td data-parametro="Olor">Olor</td><td>Sensiorial</td><td><input type="text"></td>
              <td><select data-tiempo="T0"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T1"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T2"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T3"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
            </tr>
             </tbody>
    </table>

    <h2>Estabilidad Natural</h2>
    <table data-tipo-estabilidad="Natural">
        <thead>
           <tr>
            <th>An√°lisis</th>
            <th>Par√°metro evaluado</th>
            <th>M√©todo utilizado</th>
            <th>Especific.</th>
            <th>T3</th><th>T6</th><th>T9</th><th>T12</th><th>T18</th><th>T24</th><th>T27</th><th>T30</th><th>T33</th><th>T36</th>
           </tr>
        </thead>
        <tbody>
           <tr>
              <td rowspan="4">Organol√©ptico</td>
              <td data-parametro="Apariencia">Apariencia</td><td>Sensiorial</td><td><input type="text"></td>
              <td><select data-tiempo="T3"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T6"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              <td><select data-tiempo="T9"><option>Cumple</option><option>No Cumple</option><option>No Aplica</option></select></td>
              </tr>
           </tbody>
    </table>
    </form>

  <button class="btn" style="background-color: #65b45a;" onclick="guardarFormatoCompleto()">üíæ Guardar Formulario Completo</button>

  <script>
    function guardarFormatoCompleto() {
      const lote = document.getElementById('lote-principal').value;
      if (!lote) {
        alert("El 'N√∫mero de lote' es obligatorio para guardar el formato.");
        return;
      }
      
      const resultados = [];
      const tablas = document.querySelectorAll('table[data-tipo-estabilidad]');

      tablas.forEach(tabla => {
        const tipo = tabla.dataset.tipoEstabilidad;
        const filas = tabla.querySelectorAll('tbody tr');
        
        filas.forEach(fila => {
          const parametroEl = fila.querySelector('td[data-parametro]');
          if (!parametroEl) return;
          
          const parametro = parametroEl.dataset.parametro;
          const especificacion = fila.querySelector('td:nth-child(4) input').value;
          const selects = fila.querySelectorAll('select[data-tiempo], input[data-tiempo]');
          
          selects.forEach(select => {
            resultados.push({
              tipo: tipo,
              parametro: parametro,
              tiempo: select.dataset.tiempo,
              especificacion: especificacion,
              resultado: select.value
            });
          });
        });
      });

      fetch('/api/resultados', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ lote: lote, resultados: resultados })
      })
      .then(res => res.json())
      .then(response => {
        console.log('Success:', response);
        alert(`Resultados para el lote ${lote} guardados exitosamente.`);
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Hubo un error al guardar los resultados.');
      });
    }
  </script>
</body>
</html>